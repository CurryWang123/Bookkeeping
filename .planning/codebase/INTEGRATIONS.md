# 外部集成 (INTEGRATIONS.md)

## 数据库：Supabase (BaaS)

| 配置项 | 值 |
|--------|-----|
| 服务提供商 | Supabase |
| 项目 URL | `https://ccivqpgntdotgpswmdnp.supabase.co` |
| 匿名密钥 | `sb_publishable_jp0yMSee57xUEMPIFKmPVA_BG1qs3s3` |
| SDK 版本 | `@supabase/supabase-js@2.39.0` |
| 引入方式 | CDN: `https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/+esm` |

### 配置文件位置

`js/supabase.js`:
```javascript
const SUPABASE_URL = 'https://ccivqpgntdotgpswmdnp.supabase.co'
const SUPABASE_ANON_KEY = 'sb_publishable_jp0yMSee57xUEMPIFKmPVA_BG1qs3s3'

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
```

---

## 数据库表结构

### employees - 员工表

```sql
CREATE TABLE employees (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);
```

### products - 产品表

```sql
CREATE TABLE products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  code TEXT NOT NULL,
  name TEXT NOT NULL,
  price DECIMAL(10, 2) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);
```

### sales_records - 销售记录表

```sql
CREATE TABLE sales_records (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  employee_id BIGINT REFERENCES employees(id) ON DELETE RESTRICT,
  product_id BIGINT REFERENCES products(id) ON DELETE RESTRICT,
  record_date DATE NOT NULL,
  quantity DECIMAL(10, 2) NOT NULL,
  unit_price DECIMAL(10, 2) NOT NULL,
  total_amount DECIMAL(10, 2) NOT NULL,
  is_return BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);
```

---

## 外部 API 调用

### Supabase JavaScript SDK

所有数据库操作通过 `js/db.js` 封装：

```javascript
import { createClient } from '@supabase/supabase-js'
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
```

### 主要操作

| 模块 | 方法 | 说明 |
|-----|------|------|
| employees | `list()` | 获取所有员工 |
| employees | `add(name)` | 添加员工 |
| employees | `delete(id)` | 删除员工 |
| products | `list()` | 获取所有产品 |
| products | `add(data)` | 添加产品 |
| products | `update(id, data)` | 更新产品 |
| products | `delete(id)` | 删除产品 |
| products | `importBatch(records)` | 批量导入产品 |
| salesRecords | `list(month?)` | 获取销售记录（可选月份筛选） |
| salesRecords | `add(data)` | 添加销售记录 |
| salesRecords | `delete(id)` | 删除销售记录 |

---

## 第三方服务集成

### SheetJS (xlsx)

用于 Excel 导入导出：

```javascript
// 导出 Excel
XLSX.utils.book_new()
XLSX.utils.json_to_sheet()
XLSX.writeFile()

// 导入 Excel
XLSX.read(data, { type: 'array' })
XLSX.utils.sheet_to_json()
```

### Font Awesome

用于界面图标：

```html
<i class="fas fa-calendar"></i>
<i class="fas fa-edit"></i>
<i class="fas fa-trash"></i>
```
